#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <unistd.h>
#include <wait.h>

char Alexis[6][5][5] = {{{' ','A','A','A',' '},{'A',' ',' ',' ','A'},{'A','A','A','A','A'},{'A',' ',' ',' ','A'},{'A',' ',' ',' ','A'}},{{'L',' ',' ',' ',' '} ,/**/{'L',' ',' ',' ',' '},{'L',' ',' ',' ',' '},{'L',' ',' ',' ',' '},{'L','L','L','L','L'}},/**/{{'E','E','E','E','E'},{'E',' ',' ',' ',' '},{'E','E','E','E','E'},{'E',' ',' ',' ',' '},{'E','E','E','E','E'}},/**/{{'X',' ',' ',' ','X'},{' ','X',' ','X',' '},{' ',' ','X',' ',' '},{' ','X',' ','X',' '},{'X',' ',' ',' ','X'}},/**/{{'I','I','I','I','I'},{' ',' ','I',' ',' '},{' ',' ','I',' ',' '},{' ',' ','I',' ',' '},{'I','I','I','I','I'}},/**/{{'S','S','S','S','S'},{'S',' ',' ',' ',' '},{'S','S','S','S','S'},{' ',' ',' ',' ','S'},{'S','S','S','S','S'}}};

char Diego[5][5][5] = {{{'D','D','D','D',' '},{'D',' ',' ',' ','D'},{'D',' ',' ',' ','D'},{'D',' ',' ',' ','D'},{'D','D','D','D',' '}},/**/{{'I','I','I','I','I'},{' ',' ','I',' ',' '},{' ',' ','I',' ',' '},{' ',' ','I',' ',' '},{'I','I','I','I','I'}},/**/{{'E','E','E','E','E'},{'E',' ',' ',' ',' '},{'E','E','E','E','E'},{'E',' ',' ',' ',' '},{'E','E','E','E','E'}},/**/{{'G','G','G','G','G'},{'G',' ',' ',' ',' '},{'G',' ','G','G','G'},{'G',' ',' ',' ','G'},{'G','G','G','G','G'}},/**/{{' ','O','O','O',' '},{'O',' ',' ',' ','O'},{'O',' ',' ',' ','O'},{'O',' ',' ',' ','O'},{' ','O','O','O',' '}}};

char matAlexis[9][5][5] = {{{' ','A','A','A',' '},{'A',' ',' ',' ','A'},{'A','A','A','A','A'},{'A',' ',' ',' ','A'},{'A',' ',' ',' ','A'}},/**/{{'0','0','0','0','0'},{'0',' ',' ',' ','0'},{'0',' ',' ',' ','0'},{'0',' ',' ',' ','0'},{'0','0','0','0','0'}} , /**/{{' ',' ','1',' ',' '},{' ','1','1',' ',' '},{' ',' ','1',' ',' '},{' ',' ','1',' ',' '},{'1','1','1','1','1'}}, /**/{{'0','0','0','0','0'},{'0',' ',' ',' ','0'},{'0',' ',' ',' ','0'},{'0',' ',' ',' ','0'},{'0','0','0','0','0'}}, /**/{{'2','2','2','2',' '},{' ',' ',' ',' ','2'},{' ','2','2','2','2'},{'2',' ',' ',' ',' '},{'2','2','2','2','2'}}, /**/{{' ',' ','1',' ',' '},{' ','1','1',' ',' '},{' ',' ','1',' ',' '},{' ',' ','1',' ',' '},{'1','1','1','1','1'}}, /**/{{' ',' ','1',' ',' '},{' ','1','1',' ',' '},{' ',' ','1',' ',' '},{' ',' ','1',' ',' '},{'1','1','1','1','1'}}, /**/{{' ',' ','4','4',' '},{' ','4',' ','4',' '},{'4','4','4','4','4'},{' ',' ',' ','4',' '},{' ',' ',' ','4',' '}},/**/{{'3','3','3','3',' '},{' ',' ',' ',' ','3'},{'3','3','3','3',' '},{' ',' ',' ',' ','3'},{'3','3','3','3',' '}}};

char matDiego[9][5][5] = {{{' ','A','A','A',' '},{'A',' ',' ',' ','A'},{'A','A','A','A','A'},{'A',' ',' ',' ','A'},{'A',' ',' ',' ','A'}},/**/{{'0','0','0','0','0'},{'0',' ',' ',' ','0'},{'0',' ',' ',' ','0'},{'0',' ',' ',' ','0'},{'0','0','0','0','0'}} , /**/{{' ',' ','1',' ',' '},{' ','1','1',' ',' '},{' ',' ','1',' ',' '},{' ',' ','1',' ',' '},{'1','1','1','1','1'}}, /**/{{' ',' ','1',' ',' '},{' ','1','1',' ',' '},{' ',' ','1',' ',' '},{' ',' ','1',' ',' '},{'1','1','1','1','1'}}, /**/{{' ','6','6','6','6'},{'6',' ',' ',' ',' '},{'6','6','6','6',' '},{'6',' ',' ',' ','6'},{' ','6','6','6',' '}}, /**/{{' ','8','8','8',' '},{'8',' ',' ',' ','8'},{' ','8','8','8',' '},{'8',' ',' ',' ','8'},{' ','8','8','8',' '}}, /**/{{'0','0','0','0','0'},{'0',' ',' ',' ','0'},{'0',' ',' ',' ','0'},{'0',' ',' ',' ','0'},{'0','0','0','0','0'}}, /**/{{' ','9','9','9',' '},{'9',' ',' ',' ','9'},{' ','9','9','9','9'},{' ',' ',' ',' ','9'},{'9','9','9','9',' '}},/**/{{'5','5','5','5','5'},{'5',' ',' ',' ',' '},{'5','5','5','5',' '},{' ',' ',' ',' ','5'},{'5','5','5','5','5'}}};

struct thread_args{
  int n;
  int k;
};

int combRes;

void printLetter(int x, int y, char letter[x][y])
{
    for (int i = 0; i < 5; i++ )
    {
        for (int j = 0; j < 5; j++ )
        {
            printf("%c", letter[i][j] );
        }
        printf("\n");
    }
}

void printName(int n, int x, int y, char name[n][x][y])
{
    for(int k = 0; k < n; k++)
    {
        printLetter(x,y,name[k]);
    }
}


void *printer(void *params)
{
    printf("=========\n");
    printName(6, 5, 5, Alexis);
    printf("\n\n");
    printName(9, 5, 5, matAlexis);
    printf("=========\n");
    printName(5, 5, 5, Diego);
    printf("\n\n");
    printName(9, 5, 5, matDiego);
    printf("=========\n");
    pthread_exit(0);
}

void *exec(void *params)
{
    int pid;
    pid = fork();
    if ( pid < 0 )
    {
      fprintf( stderr, "Fork Failed");
      pthread_exit(0);
      exit( -1 );
    }
    else if ( pid == 0 )
    {
      execlp( "/bin/ps", "ps", "-U", "root", "-u" ,"root" ,"u", (char *) NULL);
      pthread_exit(0);
    }
    else
    {
      wait( NULL );
      printf( "Child Complete\n" );
      exit( 0 );
    }
}

int factorial(int num)
{
  int x = 1;
  for(int i=1; i<=num; i++)
  {
    x*=i;
  }
  return x;
}

void *combinatorial(void *params)
{
    struct thread_args *args = params;
    combRes = (factorial(args->n)/(factorial(args->n-args->k)*factorial(args->k)));
    pthread_exit(0);
}


int main(int argc, const char * argv[]) {

    if ( argc != 3 )
    {
      fprintf( stderr, "Progam takes 2 parameters\n");
      exit(-1);
    }
    if ( atoi(argv[1]) < atoi(argv[2]) )
    {
      fprintf( stderr, "n debe ser >= k\n");
      exit(-1);
    }
    struct thread_args args;
    args.n =  atoi(argv[1]);
    args.k = atoi(argv[2]);

    pthread_t tid1;
    pthread_create( &tid1, NULL, printer, NULL );
    pthread_join( tid1, NULL );

    int pid;
    pid = fork();
    if (pid < 0)
    {
      fprintf( stderr, "Fork Failed");
      exit(-1);
    }
    else if (pid == 0)
    {
      execlp( "/bin/ps", "ps", "-U", "root", "-u" ,"root" ,"u", (char *) NULL);
    }
    else
    {
      wait( NULL );
      pthread_t tid3;
      pthread_create(&tid3, NULL, combinatorial, (void*)&args);
      pthread_join( tid3, NULL );
      printf("La combinatoria de %d en %d es %d\n", args.n, args.k, combRes);
      exit(0);
    }
    return 0;
}
